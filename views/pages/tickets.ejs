<!DOCTYPE html>
<html>
<head>
  <title>Ticket System - Under Development</title>
  <link rel="stylesheet" href="/css/bootstrap.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
	<body>
		<h1>Ticket System</h1>
		<h2>Under development</h2>
		<p class="text-justify">OK, so we put our hands up to this. We should have had this in place right from the begining but with the project getting bigger its not getting more difficult to manage. We want you the users to be able to shape the direction of chatsplosion and so we shall soon be unveiling our new ticketing system.
		</p>
		<p>With the new system you will be able to post suggestions or report bugs. Users can then vote on these to raise the priority of that ticket. The development team will then take the highest voted tickets and try to resolve them asap.</p>
		<p>Kinds Regards,</p>
		<p>The Development Team</p>

		<div class="row">
			<div class="col-xs-12">
				<h1>Tickets</h1>
				<button type="button" class="btn btn-success navbar-btn" data-toggle="modal" data-target="#ticketModel">
					<i class="glyphicon glypicon-plus"></i> New Ticket
				</button>
			</div>
		</div>

		<div class="row">
			<div class="col-xs-12">
				<ul class="tickets list-group"></ul>
			</div>
		</div>		

		<div class="modal fade" id="ticketModel" tabindex="-1" role="dialog" aria-labelledby="ticketModelLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<form id="newTicket" method="post" action="./data/tickets/">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
							<h4 class="modal-title">New Ticket</h4>
						</div>
						<div class="modal-body">
								<div class="form-group">
									<label>Title</label>
									<input type="text" name="title" class="form-control"/>
								</div>
								<div class="form-group">
									<label>Content</label>
									<input type="text" name="content" class="form-control"/>
								</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
							<button type="submit" name="submit" class="btn btn-primary">Create Ticket</button>
						</div>
					</form>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<script>
		  $(function(){
		    getTickets();
		    function getTickets(){
		      $.get('/data/tickets',function(data){
		        $('.tickets').html('');
		        if(data){
		          $.each(data,function(index,ticket){
		            var contentStr= '<li class="list-group-item" data-id="' + ticket._id +'">' + ticket.title + '( ' + ticket.votes +' )<br /><br /> ' + ticket.content +'<i title="downvote" class="glyphicon glyphicon-thumbs-up pull-right"></i>&nbsp<i title="upvote" class="glyphicon glyphicon-thumbs-down pull-right"></i></li>';
		            $('.tickets').append(contentStr).find('i.glyphicon-thumbs-up').click(function(){
			              var self = $(this);
			              alert('up');
			              $.ajax({
			                method: "PUT",
			                url: "./data/tickets/upvote/" + ticket._id
			              }).done(function(){
			                self.parent().fadeOut(500,function(){
			                  self.remove();
			                })
			              }).fail(function(err){
			                alert(err);
			              });
		            }).parent().find('i.glyphicon-thumbs-down').click(function(){
		              var self = $(this);
		              alert('down');
		              $.ajax({
		                method: "PUT",
		                url: "./data/tickets/downvote/" + ticket._id
		              }).done(function(){
		                self.parent().fadeOut(500,function(){
		                  self.remove();
		                })
		              }).fail(function(err){
		                alert(err);
		              });
		            });
		          });
		        } else {
		          $('.tickets').append('<li class="list-group-item">There are no tickets saved.</li>');
		        }
		      });
		    }
		  });
		</script>
	</body>
</html>